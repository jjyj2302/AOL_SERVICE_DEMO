  name: CI - Test and Build

  on:
    push:
      branches: [ dev, master ]
    pull_request:
      branches: [ dev, master ]

  jobs:
    backend-test:
      name: Backend Tests
      runs-on: ubuntu-latest

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Set up Python
          uses: actions/setup-python@v5
          with:
            python-version: '3.11'

        - name: Install dependencies
          run: |
            cd backend
            pip install -r requirements.txt

        - name: Run tests (if exists)
          run: |
            cd backend
            # pytest tests/ 또는 python -m pytest
            echo "Backend tests would run here"

    frontend-test:
      name: Frontend Tests
      runs-on: ubuntu-latest

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Set up Node.js
          uses: actions/setup-node@v4
          with:
            node-version: '18'

        - name: Install dependencies
          run: |
            cd frontend
            npm ci

        - name: Run tests (if exists)
          run: |
            cd frontend
            # npm test
            echo "Frontend tests would run here"

        - name: Build frontend
          env:
            CI: false
          run: |
            cd frontend
            npm run build

    docker-build:
      name: Docker Build Test
      runs-on: ubuntu-latest
      needs: [backend-test, frontend-test]

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Set up Docker Buildx
          uses: docker/setup-buildx-action@v3

        - name: Build backend image
          run: |
            docker build -t aol-backend:test ./backend

        - name: Build frontend image
          run: |
            docker build -t aol-frontend:test ./frontend

        - name: Test docker-compose
          run: |
            docker compose config
